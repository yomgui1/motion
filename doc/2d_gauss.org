#+TITLE: Solving 2d affine matrix using Gauss-Jordan method
#+AUTHOR: Guillaume Roguez
#+EMAIL: yomgui1@gmail.com
#+OPTIONS: toc:nil num:nil

* Initial state

|-----+-----+-----+-----+---+---+-----|
| px0 | py0 |   0 |   0 | 1 | 0 | ex0 |
|   0 |   0 | px0 | py0 | 0 | 1 | ey0 |
|-----+-----+-----+-----+---+---+-----|
| px1 | py1 |   0 |   0 | 1 | 0 | ex1 |
|   0 |   0 | px1 | py1 | 0 | 1 | ey1 |
|-----+-----+-----+-----+---+---+-----|
| px2 | py2 |   0 |   0 | 1 | 0 | ex2 |
|   0 |   0 | px2 | py2 | 0 | 1 | ey2 |
|-----+-----+-----+-----+---+---+-----|

* L_1/px0

px0 != 0

 |-----+---------+-----+-----+-------+---+---------|
 |   1 | py0/px0 |   0 |   0 | 1/px0 | 0 | ex0/px0 |
 |   0 |       0 | px0 | py0 |     0 | 1 | ey0     |
 | px1 |     py1 |   0 |   0 |     1 | 0 | ex1     |
 |   0 |       0 | px1 | py1 |     0 | 1 | ey1     |
 | px2 |     py2 |   0 |   0 |     1 | 0 | ex2     |
 |   0 |       0 | px2 | py2 |     0 | 1 | ey2     |
 |-----+---------+-----+-----+-------+---+---------|

* L_3 -= px1.L_1 et L_5 -= px2.L_1

px1 != 0, px2 != 0

 |---+-------------------+-----+-----+-------------+---+-------------------|
 | 1 |           py0/px0 |   0 |   0 |       1/px0 | 0 | ex0/px0           |
 | 0 |                 0 | px0 | py0 |           0 | 1 | ey0               |
 | 0 | py1 - px1*py0/px0 |   0 |   0 | 1 - px1/px0 | 0 | ex1 - px1*ex0/px0 |
 | 0 |                 0 | px1 | py1 |           0 | 1 | ey1               |
 | 0 | py2 - px2*py0/px0 |   0 |   0 | 1 - px2/px0 | 0 | ex2 - px2*ex0/px0 |
 | 0 |                 0 | px2 | py2 |           0 | 1 | ey2               |
 |---+-------------------+-----+-----+-------------+---+-------------------|

* Simplify px0 divisions

 |---+---------+-----+-----+-------+---+---------|
 | 1 | py0/px0 |   0 |   0 | 1/px0 | 0 | ex0/px0 |
 | 0 |       0 | px0 | py0 |     0 | 1 | ey0     |
 | 0 |   A/px0 |   0 |   0 | C/px0 | 0 | E/px0   |
 | 0 |       0 | px1 | py1 |     0 | 1 | ey1     |
 | 0 |   B/px0 |   0 |   0 | D/px0 | 0 | F/px0   |
 | 0 |       0 | px2 | py2 |     0 | 1 | ey2     |
 |---+---------+-----+-----+-------+---+---------|

A = px0*py1 - px1*py0

B = px0*py2 - px2*py0

C = px0 - px1

D = px0 - px2

E = px0*ex1 - px1*ex0

F = px0*ex2 - px2*ex0

* L_3 *= px0/A and L_5 *= px0/B

A != 0\\
B != 0

 |---+---------+-----+-----+-------+---+---------|
 | 1 | py0/px0 |   0 |   0 | 1/px0 | 0 | ex0/px0 |
 | 0 |       0 | px0 | py0 |     0 | 1 | ey0     |
 | 0 |       1 |   0 |   0 |   C/A | 0 | E/A     |
 | 0 |       0 | px1 | py1 |     0 | 1 | ey1     |
 | 0 |       1 |   0 |   0 |   D/B | 0 | F/B     |
 | 0 |       0 | px2 | py2 |     0 | 1 | ey2     |
 |---+---------+-----+-----+-------+---+---------|

* Lines swap

|---+---------+-----+-----+-------+---+---------|
| 1 | py0/px0 |   0 |   0 | 1/px0 | 0 | ex0/px0 |
| 0 |       1 |   0 |   0 |   C/A | 0 | E/A     |
| 0 |       1 |   0 |   0 |   D/B | 0 | F/B     |
| 0 |       0 | px0 | py0 |     0 | 1 | ey0     |
| 0 |       0 | px1 | py1 |     0 | 1 | ey1     |
| 0 |       0 | px2 | py2 |     0 | 1 | ey2     |
|---+---------+-----+-----+-------+---+---------|

* L_3 -= L_2

|---+---------+-----+-----+-----------+---+-----------|
| 1 | py0/px0 |   0 |   0 |     1/px0 | 0 | ex0/px0   |
| 0 |       1 |   0 |   0 |       C/A | 0 | E/A       |
| 0 |       0 |   0 |   0 | D/B - C/A | 0 | F/B - E/A |
| 0 |       0 | px0 | py0 |         0 | 1 | ey0       |
| 0 |       0 | px1 | py1 |         0 | 1 | ey1       |
| 0 |       0 | px2 | py2 |         0 | 1 | ey2       |
|---+---------+-----+-----+-----------+---+-----------|

* L_4 /= px0, then swap with L_3

|---+---------+-----+---------+-----------+---+-----------|
| 1 | py0/px0 |   0 |       0 | 1/px0     | 0 | ex0/px0   |
| 0 |       1 |   0 |       0 | C/A       | 0 | E/A       |
| 0 |       0 |   1 | py0/px0 | 1/px0     | 1 | ey0/px0   |
| 0 |       0 |   0 |       0 | D/B - C/A | 0 | F/B - E/A |
| 0 |       0 | px1 |     py1 | 1         | 1 | ey1       |
| 0 |       0 | px2 |     py2 | 1         | 1 | ey2       |
|---+---------+-----+---------+-----------+---+-----------|

* L_5 -= px1.L_3 and L_6 -= px2.L_3

|---+---------+---+-----------------+-----------+-----------+-----------------|
| 1 | py0/px0 | 0 |               0 | 1/px0     |         0 | ex0/px0         |
| 0 |       1 | 0 |               0 | C/A       |         0 | E/A             |
| 0 |       0 | 1 |         py0/px0 | 1/px0     |         1 | ey0/px0         |
| 0 |       0 | 0 |               0 | D/B - C/A |         0 | F/B - E/A       |
| 0 |       0 | 0 | py1-px1*py0/px0 | 0         | 1-px1/px0 | ey1-px1*ey0/px0 |
| 0 |       0 | 0 | py2-px2*py0/px0 | 0         | 1-px2/px0 | ey2-px2*ey0/px0 |
|---+---------+---+-----------------+-----------+-----------+-----------------|

* Simplify px0 divisions

 |---+---------+---+---------+-----------+-------+-----------|
 | 1 | py0/px0 | 0 |       0 | 1/px0     |     0 | ex0/px0   |
 | 0 |       1 | 0 |       0 | C/A       |     0 | E/A       |
 | 0 |       0 | 1 | py0/px0 | 1/px0     |     0 | ey0/px0   |
 | 0 |       0 | 0 |       0 | D/B - C/A |     0 | F/B - E/A |
 | 0 |       0 | 0 |   A/px0 | 0         | C/px0 | G/px0     |
 | 0 |       0 | 0 |   B/px0 | 0         | D/px0 | H/px0     |
 |---+---------+---+---------+-----------+-------+-----------|

G = px0*ey1-px1*ey0\\
H = px0*ey2-px2*ey0

* L_5 *= px0/A and L_6 *= px0/B

px0/A != 0

 |---+---------+---+---------+-----------+-----+-----------|
 | 1 | py0/px0 | 0 |       0 | 1/px0     |   0 | ex0/px0   |
 | 0 |       1 | 0 |       0 | C/A       |   0 | E/A       |
 | 0 |       0 | 1 | py0/px0 | 1/px0     |   0 | ey0/px0   |
 | 0 |       0 | 0 |       0 | D/B - C/A |   0 | F/B - E/A |
 | 0 |       0 | 0 |       1 | 0         | C/A | G/A       |
 | 0 |       0 | 0 |       1 | 0         | D/B | H/B       |
 |---+---------+---+---------+-----------+-----+-----------|

* L_6 -= L_5

|---+---------+---+---------+-----------+-----------+-----------|
| 1 | py0/px0 | 0 |       0 | 1/px0     |         0 | ex0/px0   |
| 0 |       1 | 0 |       0 | C/A       |         0 | E/A       |
| 0 |       0 | 1 | py0/px0 | 1/px0     |         0 | ey0/px0   |
| 0 |       0 | 0 |       0 | D/B - C/A |         0 | F/B - E/A |
| 0 |       0 | 0 |       1 | 0         |       C/A | G/A       |
| 0 |       0 | 0 |       0 | 0         | D/B - C/A | H/B - G/A |
|---+---------+---+---------+-----------+-----------+-----------|

* Swap L_5 and L_4, then simplify

 |---+---------+---+---------+-------+-----+---------|
 | 1 | py0/px0 | 0 |       0 | 1/px0 |   0 | ex0/px0 |
 | 0 |       1 | 0 |       0 | C/A   |   0 | E/A     |
 | 0 |       0 | 1 | py0/px0 | 1/px0 |   0 | ey0/px0 |
 | 0 |       0 | 0 |       1 | 0     | C/A | G/A     |
 | 0 |       0 | 0 |       0 | I     |   0 | J       |
 | 0 |       0 | 0 |       0 | 0     |   I | K       |
 |---+---------+---+---------+-------+-----+---------|

I = D/B - C/A

J = F/B - E/A

K = H/B - G/A

* L_5 /= I et L_6 /= I

I != 0

 |---+---------+---+---------+-------+---+---------|
 | 1 | py0/px0 | 0 |       0 | 1/px0 | 0 | ex0/px0 |
 | 0 |       1 | 0 |       0 | C/A   | 0 | E/A     |
 | 0 |       0 | 1 | py0/px0 | 1/px0 | 0 | ey0/px0 |
 | 0 |       0 | 0 |       1 | C/A   | 0 | G/A     |
 | 0 |       0 | 0 |       0 | 1     | 0 | J/I     |
 | 0 |       0 | 0 |       0 | 0     | 1 | K/I     |
 |---+---------+---+---------+-------+---+---------|

* Solving equations

 |---+---------+---+---------+-------+---+---+----+---+---------|
 | 1 | py0/px0 | 0 |       0 | 1/px0 | 0 |   | a  |   | ex0/px0 |
 | 0 |       1 | 0 |       0 | C/A   | 0 |   | b  |   | E/A     |
 | 0 |       0 | 1 | py0/px0 | 1/px0 | 0 | . | c  | = | ey0/px0 |
 | 0 |       0 | 0 |       1 | C/A   | 0 |   | d  |   | G/A     |
 | 0 |       0 | 0 |       0 | 1     | 0 |   | tx |   | J/I     |
 | 0 |       0 | 0 |       0 | 0     | 1 |   | ty |   | K/I     |
 |---+---------+---+---------+-------+---+---+----+---+---------|


ty = K/I = (A.H - B.G) / (A.D - B.C)

tx = J/I = (A.F - B.E) / (A.D - B.C)

d = 1/A . (G - C.tx)

b = 1/A . (E - C.tx)

c = 1/px0 . (ey0 - tx - py0.d)

a = 1/px0 . (ex0 - tx - py0.b)
